<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Robo Adventure - Final Stable Version</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #1a1a1a;
            overflow: hidden;
        }

        canvas {
            border: 5px solid #fff;
            background-color: #5c94fa;
            image-rendering: pixelated;
            cursor: crosshair;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas" width="1280" height="720"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // --- CONFIGURAÇÃO DE AMBIENTE ---
        let aguardandoResetInput = false;
        let mouseWorldX = 0, mouseWorldY = 0;
        let exibindoMenuTeleporte = false, ferramentaEdicaoAtiva = false;
        let emCutscene = false, cenaArenaOcorreu = false;
        let intensidadeTremor = 0, arenaConcluida = false;
        const limiteEsquerdoArena = 27685;
        const limiteDireitoArena = 28974;

        // --- CAMINHOS DE PASTAS (ORGANIZE ASSIM NO GITHUB) ---
        const pathLevels = "levels/";
        const pathRobo = "sprites_robo/";
        const pathInimigos = "sprites_inimigos/"; // Renomeie sua pasta para sprites_inimigos

        // Função de carregamento seguro
        function criarImg(src) {
            const img = new Image();
            img.src = src;
            img.onerror = () => console.error("Não encontrei: " + src);
            return img;
        }

        // --- CARREGAMENTO DE IMAGENS ---
        const imgCidadeDistante = criarImg(pathLevels + "level1_spt/backgrounds_lv1/cit1.png");
        const imgPlataformaS1 = criarImg(pathLevels + "level1_spt/plt_1/pltsp_1.png");
        const imgRoboStand = criarImg(pathRobo + "stand_1/stand_rb1.png");

        // Inimigos (BearCib)
        const imgsMiniBear = [];
        for (let i = 1; i <= 8; i++) {
            imgsMiniBear.push(criarImg(pathInimigos + "bearcibv1/bcq" + i + ".png"));
        }

        // --- ENTIDADES E LÓGICA ---
        const robo = {
            worldX: 332, currentX: 332, y: 580, largura: 50, altura: 100,
            velX: 0, velY: 0, gravidade: 0.4, forcaPulo: -12,
            estaNoChao: false, direcao: 1, boostAtivo: false, rastros: []
        };

        const miniBear = {
            x: 28740, y: 566, w: 78, h: 120, velX: -2, vida: 2,
            morto: false, timerMorte: 0, ondaAtual: 1, totalOndas: 3
        };

        // --- CLASSE INIMIGO COMUM ---
        class InimigoMinibear {
            constructor(x, y, limiteEsq, limiteDir) {
                this.x = x; this.y = y; this.w = 78; this.h = 120;
                this.limiteEsq = limiteEsq; this.limiteDir = limiteDir;
                this.velX = 2; this.vida = 2; this.morto = false;
                this.timerMorte = 0; this.direcao = 1; this.frame = 0;
            }
            atualizar() {
                if (this.morto) return;
                if (this.timerMorte > 0) { this.timerMorte--; if (this.timerMorte <= 0) this.morto = true; return; }

                this.x += this.velX;
                if (this.x < this.limiteEsq || this.x + this.w > this.limiteDir) {
                    this.velX *= -1; this.direcao = this.velX > 0 ? 1 : -1;
                }
            }
        }

        let inimigosComuns = [new InimigoMinibear(2000, 560, 1800, 2500)];

        // --- CONTROLES ---
        window.addEventListener("keydown", (e) => {
            if (e.code === "KeyD") robo.velX = 5;
            if (e.code === "KeyA") robo.velX = -5;
            if (e.code === "Space" && robo.estaNoChao) { robo.velY = robo.forcaPulo; robo.estaNoChao = false; }
        });
        window.addEventListener("keyup", (e) => { if (e.code === "KeyD" || e.code === "KeyA") robo.velX = 0; });

        // --- LOOP PRINCIPAL ---
        function loop() {
            // Gravidade e Chão simples
            robo.y += robo.velY;
            if (robo.y > 580) { robo.y = 580; robo.velY = 0; robo.estaNoChao = true; }
            else { robo.velY += robo.gravidade; }

            robo.worldX += robo.velX;
            inimigosComuns.forEach(i => i.atualizar());

            desenharCena();
            requestAnimationFrame(loop);
        }

        function desenharCena() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Fundo Parallax
            if (imgCidadeDistante.complete) ctx.drawImage(imgCidadeDistante, 0, 0, 1280, 720);

            // Chão
            if (imgPlataformaS1.complete) ctx.drawImage(imgPlataformaS1, 0, 680, 1550, 40);

            // Inimigos Comuns
            inimigosComuns.forEach(i => {
                if (!i.morto && imgsMiniBear[0].complete) {
                    ctx.save();
                    if (i.timerMorte > 0) ctx.filter = "brightness(10)";
                    ctx.drawImage(imgsMiniBear[0], i.x, i.y, i.w, i.h);
                    ctx.restore();
                }
            });

            // Robô
            if (imgRoboStand.complete) {
                ctx.save();
                ctx.translate(robo.worldX, robo.y);
                if (robo.direcao === -1) ctx.scale(-1, 1);
                ctx.drawImage(imgRoboStand, -25, 0, 50, 100);
                ctx.restore();
            }

            // --- TEXTO DE DEBUG (JI-PARANÁ PROTOCOL) ---
            ctx.fillStyle = "white";
            ctx.font = "bold 20px monospace";
            ctx.fillText("SISTEMA ONLINE - JI-PARANÁ PROTOCOL", 20, 40);

            if (!imgRoboStand.complete) {
                ctx.fillStyle = "red";
                ctx.fillText("ERRO: PASTAS NO GITHUB DEVEM SER 'sprites_robo' E 'levels'", 20, 80);
            }
        }

        loop();
    </script>
</body>

</html>